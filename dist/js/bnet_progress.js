function fetchRaid(e,a){$.ajax({url:"https://eu.api.battle.net/wow/zone/"+e+"?locale=en_GB&apikey=9tdd7cvwkq922fz7a6438wvvftpf35db",type:"GET",success:function(r){renderRaid(r,e,a)},error:handleAjaxError})}function fetchRaiderIO(e,a,r){$.ajax({url:"https://raider.io/api/v1/raiding/raid-rankings?raid="+e+"&difficulty="+a+"&region=eu&realm=connected-alonsus",type:"GET",success:function(e){var n=$.grep(e.raidRankings,function(e,a){return 48482==e.guild.id});n&&0!=n.length&&r(n[0],a)}})}function renderRaid(e,a,r){var n=$('.progress_data[data-zoneid="'+a+'"]');$('.loading[data-zoneid="'+a+'"]');n.prepend('<p class="hidden-xs col-xs-12 col-lg-10 col-lg-offset-1 text-center">'+e.description+"</p>");var t=0;$.each(e.bosses,function(e,a){t+=1;var r,o,l=a.urlSlug,i=$.grep(slugs,function(e,a){return e.slug==l});i&&0!=i.length&&(o=i[0].full_slug,r=o.replace(/-/g,"")),n.append('<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3"><div class="boss" style="background-image:url(http://wow.zamimg.com/images/wow/journal/ui-ej-boss-'+r+'.png)" id="'+a.id+'" data-slug="'+o+'"><h3 class="center-block"><a href="https://www.wowhead.com/npc='+a.id+'">'+a.name+'</a></h3><div class="text-center mode"></div><div class="text-center date"></div></div></div>')}),$('.prog_bar[data-zoneid="'+a+'"]').attr("data-total",t),fillRaid(a,r)}function fillRaid(e,a){function r(a,r){console.log(a);var n=0;$.each(a.encountersDefeated,function(e,a){n+=1;var t=$('.boss[data-slug="'+a.slug+'"]'),o='<span class="glyphicon glyphicon-star" aria-hidden="true"></span> '+r+' <span class="glyphicon glyphicon-star" aria-hidden="true"></span>',l=new Date(a.firstDefeated);l="Defeated "+timeConverter(l),"heroic"==r&&1==t.hasClass("mythic")?t.removeClass("heroic"):(t.addClass("complete "+r),t.find(".mode").html(o),t.find(".date").html(l))}),renderRank(a),renderProgBar(r,e,n),progComplete(e)}fetchRaiderIO(a,"heroic",r),fetchRaiderIO(a,"mythic",r)}function renderProgBar(e,a,r){var n=$(".prog_bar."+e+'[data-zoneid="'+a+'"]'),t=n.attr("data-total"),o=(r/t*100).toFixed(0);n.find(".progress").attr("data-original-title","Defeated "+r+" of "+t),n.find(".progress-bar").attr("aria-valuenow",o).html(o+"%").css("width",o+"%"),$('[data-toggle="tooltip"]').tooltip()}function progComplete(e){$('.loading[data-zoneid="'+e+'"]').hide(),$('.progress_data[data-zoneid="'+e+'"]').fadeIn()}function renderRank(e){(0==currentRealm||e.rank<currentRealm)&&(console.log(e.rank),console.log(currentRealm),currentRealm=e.rank,$(".realm .rank_number").html(e.rank),$(".rank").fadeIn()),(0==currentRegion||e.regionRank<currentRegion)&&(currentRegion=e.regionRank,$(".region .rank_number").html(e.regionRank),$(".rank").fadeIn())}function timeConverter(e){var a=new Date(e),r=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],n=a.getFullYear(),t=r[a.getMonth()],o=a.getDate(),l=(a.getHours(),a.getMinutes(),a.getSeconds(),[1,21,31]),i=[2,22],s=[3,23],d=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,24,25,26,27,28,29,30];return-1!=l.indexOf(o)?o+="st":-1!=i.indexOf(o)?o+="nd":-1!=s.indexOf(o)?o+="rd":-1!=d.indexOf(o)&&(o+="th"),o+" "+t+" "+n}function handleAjaxError(e,a,r){503==e.status?($("#error_503").fadeIn(),$(".progress_container").hide()):504==e.status&&($("#error_504").fadeIn(),$(".progress_container").hide())}function loadFinished(){$.getScript("https://wow.zamimg.com/widgets/power.js"),wowhead_tooltips={colorlinks:!0,iconizelinks:!0,renamelinks:!1}}var currentRealm=0,currentRegion=0,slugs=[{slug:"taloc",full_slug:"taloc"},{slug:"mother",full_slug:"mother"},{slug:"fetid-devourer",full_slug:"fetid-devourer"},{slug:"zekvoz",full_slug:"zekvoz-herald-of-nzoth"},{slug:"vectis",full_slug:"vectis"},{slug:"zul",full_slug:"zul-reborn"},{slug:"mythrax",full_slug:"mythrax-the-unraveler"},{slug:"ghuun",full_slug:"ghuun"}];$(function(){fetchRaid(9389,"uldir")});