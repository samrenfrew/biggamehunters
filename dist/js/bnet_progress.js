function fetchRaid(e,r){$.ajax({url:"https://eu.api.blizzard.com/wow/zone/"+e+"?locale=en_GB&access_token="+token,type:"GET",success:function(n){renderRaid(n,e,r)},error:handleAjaxError})}function fetchRaiderIO(e,r,n){$.ajax({url:"https://raider.io/api/v1/raiding/raid-rankings?raid="+e+"&difficulty="+r+"&region=eu&realm=connected-alonsus",type:"GET",success:function(e){var a=$.grep(e.raidRankings,function(e,r){return 48482==e.guild.id});a&&0!=a.length&&n(a[0],r)}})}function renderRaid(e,r,n){var a=$('.progress_data[data-zoneid="'+r+'"]');$('.loading[data-zoneid="'+r+'"]');a.prepend('<p class="hidden-xs col-xs-12 col-lg-10 col-lg-offset-1 text-center">'+e.description+"</p>");var t=0;$.each(e.bosses,function(e,r){t+=1;var n,o,l=r.urlSlug,i=$.grep(slugs,function(e,r){return e.slug==l});i&&0!=i.length&&(o=i[0].full_slug,n=o.replace(/-/g,"")),a.append('<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3"><div class="boss" style="background-image:url(http://wow.zamimg.com/images/wow/journal/ui-ej-boss-'+n+'.png)" id="'+r.id+'" data-slug="'+o+'"><h3 class="center-block"><a href="https://www.wowhead.com/npc='+r.id+'">'+r.name+'</a></h3><div class="text-center mode"></div><div class="text-center date"></div></div></div>')}),$('.prog_bar[data-zoneid="'+r+'"]').attr("data-total",t),fillRaid(r,n)}function fillRaid(e,r){function n(r,n){console.log(r);var a=0;$.each(r.encountersDefeated,function(e,r){a+=1;var t=$('.boss[data-slug="'+r.slug+'"]'),o='<span class="glyphicon glyphicon-star" aria-hidden="true"></span> '+n+' <span class="glyphicon glyphicon-star" aria-hidden="true"></span>',l=new Date(r.firstDefeated);l="Defeated "+timeConverter(l),"heroic"==n&&1==t.hasClass("mythic")?t.removeClass("heroic"):(t.addClass("complete "+n),t.find(".mode").html(o),t.find(".date").html(l))}),renderRank(r),renderProgBar(n,e,a),progComplete(e)}fetchRaiderIO(r,"heroic",n),fetchRaiderIO(r,"mythic",n)}function renderProgBar(e,r,n){var a=$(".prog_bar."+e+'[data-zoneid="'+r+'"]'),t=a.attr("data-total"),o=(n/t*100).toFixed(0);a.find(".progress").attr("data-original-title","Defeated "+n+" of "+t),a.find(".progress-bar").attr("aria-valuenow",o).html(o+"%").css("width",o+"%"),$('[data-toggle="tooltip"]').tooltip()}function progComplete(e){$('.loading[data-zoneid="'+e+'"]').hide(),$('.progress_data[data-zoneid="'+e+'"]').fadeIn()}function renderRank(e){(0==currentRealm||e.rank<currentRealm)&&(console.log(e.rank),console.log(currentRealm),currentRealm=e.rank,$(".realm .rank_number").html(e.rank),$(".rank").fadeIn()),(0==currentRegion||e.regionRank<currentRegion)&&(currentRegion=e.regionRank,$(".region .rank_number").html(e.regionRank),$(".rank").fadeIn())}function timeConverter(e){var r=new Date(e),n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],a=r.getFullYear(),t=n[r.getMonth()],o=r.getDate(),l=(r.getHours(),r.getMinutes(),r.getSeconds(),[1,21,31]),i=[2,22],s=[3,23],d=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,24,25,26,27,28,29,30];return-1!=l.indexOf(o)?o+="st":-1!=i.indexOf(o)?o+="nd":-1!=s.indexOf(o)?o+="rd":-1!=d.indexOf(o)&&(o+="th"),o+" "+t+" "+a}function handleAjaxError(e,r,n){503==e.status?($("#error_503").fadeIn(),$(".progress_container").hide()):504==e.status&&($("#error_504").fadeIn(),$(".progress_container").hide())}function loadFinished(){$.getScript("https://wow.zamimg.com/widgets/power.js"),wowhead_tooltips={colorlinks:!0,iconizelinks:!0,renamelinks:!1}}var currentRealm=0,currentRegion=0,slugs=[{slug:"taloc",full_slug:"taloc"},{slug:"mother",full_slug:"mother"},{slug:"fetid-devourer",full_slug:"fetid-devourer"},{slug:"zekvoz",full_slug:"zekvoz-herald-of-nzoth"},{slug:"vectis",full_slug:"vectis"},{slug:"zul",full_slug:"zul-reborn"},{slug:"mythrax",full_slug:"mythrax-the-unraveler"},{slug:"ghuun",full_slug:"ghuun"}];$(function(){function e(){fetchRaid(9389,"uldir")}token(e)});